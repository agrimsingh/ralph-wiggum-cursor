#!/usr/bin/env bash
set -euo pipefail

# Ralph shim for python - blocks launching an interactive REPL.

WRAPPER_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

real_python() {
  local filtered_path=""
  local IFS=":"
  for p in $PATH; do
    [[ "$p" == "$WRAPPER_DIR" ]] && continue
    filtered_path+="${filtered_path:+:}$p"
  done
  PATH="$filtered_path" command -v python || true
}

REAL_PYTHON="$(real_python)"
if [[ -z "${REAL_PYTHON}" ]]; then
  echo "ralph python shim: real python not found" >&2
  exit 127
fi

if [[ $# -eq 0 ]]; then
  echo "ralph python shim: blocked interactive 'python' REPL (provide a script)" >&2
  exit 2
fi

exec "$REAL_PYTHON" "$@"
